var __defProp = Object.defineProperty;
var __name = (target, value) => __defProp(target, "name", { value, configurable: true });

// src/knowledgeBase.ts
var KNOWLEDGE_BASE = [
  {
    id: "home-hero",
    title: "Home Hero: One Voice, One Mission",
    url: "/",
    content: "Safety for Women Movement presents a pan-India collaborative mission for a nation where every woman is safe. The homepage headline is 'One Voice, One Mission' with the subtitle 'A Safer India for Women' and a call to join the movement."
  },
  {
    id: "home-description",
    title: "Home Mission Statement",
    url: "/",
    content: "The movement invites people to turn hope into action: join a unified community that builds practical solutions so no woman is left without help."
  },
  {
    id: "about-story",
    title: "About the Movement",
    url: "/about",
    content: "Born from the urgent need for change after tragic gender-based violence incidents, Safety for Women transforms distress into meaningful action. It unites citizens, communities, law enforcement, and policymakers to focus on practical solutions, collaboration, and sustainable impact."
  },
  {
    id: "about-vision",
    title: "Vision",
    url: "/about",
    content: "The vision is to change the narrative that India is unsafe for women by taking everyday, practical steps to make streets, homes, workplaces, and public spaces safer."
  },
  {
    id: "about-mission",
    title: "Mission",
    url: "/about",
    content: "The mission is to turn fear, anger, and frustration into concrete action, focus on what can change today, and work on simple local solutions that can be repeated across India."
  },
  {
    id: "about-values",
    title: "Values",
    url: "/about",
    content: "Values include being non-political, non-religious, and non-partisan. Real change comes from direct action, collaboration, and community ownership."
  },
  {
    id: "about-your-role",
    title: "Your Role",
    url: "/about",
    content: "Everyone has something to offer: time, skills, contacts, or lived experience. Join a team, lead small actions locally, and help rewrite the story of India into a nation that is aware, prepared, and united for safety."
  },
  {
    id: "about-plan",
    title: "The Plan",
    url: "/about",
    content: "The plan is to build teams in every state and union territory, bring together doers who are ready to act, and connect people who can contribute time, skills, networks, or resources to clear initiatives."
  },
  {
    id: "initiatives-overview",
    title: "Our Initiatives Overview",
    url: "/#initiatives",
    content: "The movement runs nine initiatives to empower communities, engage stakeholders, and create safer environments for women across India."
  },
  {
    id: "initiative-awareness-programs",
    title: "Initiative 1: Safety Awareness Programs",
    url: "/#initiatives",
    content: "Workshops in schools, colleges, workplaces, and residential communities. Topics include self-defense, legal rights, and emergency safety protocols. Request form: https://bit.ly/SFW-AwarenessProgramQuestionaire"
  },
  {
    id: "initiative-tech",
    title: "Initiative 2: Tech Solutions for Safety",
    url: "/#initiatives",
    content: "Leverages technology for safety through community safety maps, hackathons, and collaboration with tech companies to build safety-focused products. Street safety audit form: https://forms.gle/zgPLDgGwxYYPYavo9"
  },
  {
    id: "initiative-sss",
    title: "Initiative 3: Survivor Support System (SSS) - India",
    url: "/#initiatives",
    content: "Builds a unified, verified, collaborative network of NGOs, legal experts, counsellors, shelters, crisis responders, volunteers, and health professionals. Join the network: https://bit.ly/SFW-PanIndia-SurvivorSupportSystem"
  },
  {
    id: "initiative-well-lit",
    title: "Initiative 4: Safe & Well-Lit Communities",
    url: "/#initiatives",
    content: "Focuses on safety audits, fixing broken streetlights, installing new lighting, and sustainable funding with CSR partners. Goal: Zero Dark Spots. Audit form: https://docs.google.com/forms/d/e/1FAIpQLSdmdG5Kf2_tsrb8KyGlFHbdhJVnrwUzxzZZFCwq2zhd4nehBg/viewform?usp=preview"
  },
  {
    id: "initiative-citizen-police",
    title: "Initiative 5: Citizen Police Alliance Team",
    url: "/#initiatives",
    content: "Transforms passive reporting into active partnership, trains citizens, and offers Command Centre tours to understand modern policing. Tour request form: https://forms.gle/ayvdScjcJLjTCAANA. WhatsApp group: https://chat.whatsapp.com/BVmXh5pO3DuD2LPCwxsncr"
  },
  {
    id: "initiative-safety-squadrons",
    title: "Initiative 6: Network of Street-wise Safety Squadrons",
    url: "/#initiatives",
    content: "Future roadmap initiative to create last-mile volunteer squads that assist neighborhoods, respond to safety concerns, and ensure no woman is left helpless."
  },
  {
    id: "initiative-school-curriculum",
    title: "Initiative 7: Safety Education into School Curriculum",
    url: "/#initiatives",
    content: "Future roadmap initiative to integrate safety, laws, respect, and consent into school curricula. Collaborates with education experts and seeks institutional partners."
  },
  {
    id: "initiative-women-livelihood",
    title: "Initiative 8: Women Empowerment & Livelihood",
    url: "/#initiatives",
    content: "Future roadmap initiative to support skill training, financial literacy, and employment. Seeks corporate partners, vocational training institutes, and mentors."
  },
  {
    id: "initiative-awards",
    title: "Initiative 9: Annual Safety Recognition Awards",
    url: "/#initiatives",
    content: "Future roadmap initiative to establish awards that recognize Safety Champions and celebrate best practices across India. Seeks sponsors and patronage."
  },
  {
    id: "join-section",
    title: "Join the Movement Section",
    url: "/get-involved",
    content: "The Join section invites people to take the safety pledge and receive a Certificate of Commitment. The call to action is 'Let's Act for Women's Safety. Together.'"
  },
  {
    id: "get-involved-overview",
    title: "Get Involved: Overview",
    url: "/get-involved",
    content: "The Join The Movement page lists six ways to contribute: take the safety pledge, request an awareness program, become a volunteer, partner with the movement, audit street safety, or join the Survivor Support System."
  },
  {
    id: "get-involved-pledge",
    title: "Get Involved: Take the Safety Pledge",
    url: "/get-involved",
    content: "Submit your name, 10-digit mobile number, 6-digit pin code, and state to take the pledge and download a certificate. The pledge submission is stored via the API."
  },
  {
    id: "get-involved-awareness",
    title: "Get Involved: Request an Awareness Program",
    url: "/get-involved",
    content: "Request programs for schools, colleges, organizations, or communities. Form link: https://docs.google.com/forms/d/e/1FAIpQLSe8qqs23o94pBGpib1APpzrNaU9NRhCk4vrzDFHnltjuAKKIQ/viewform"
  },
  {
    id: "get-involved-volunteer",
    title: "Get Involved: Become a Volunteer",
    url: "/get-involved",
    content: "Volunteer remotely or on-ground based on your skills and time. Form link: https://docs.google.com/forms/d/e/1FAIpQLSdqzAMP1VKX1S0NbQK24R9EaO7jqOdSbq1DWz_p78ugd_8yKw/viewform"
  },
  {
    id: "get-involved-partner",
    title: "Get Involved: Partner With Us",
    url: "/get-involved",
    content: "Partner to amplify impact and create systemic change. Form link: https://docs.google.com/forms/d/e/1FAIpQLSeH9SZu6loQT4irZowzBIHJZl_SFc10JGsD6fFClXJ6cWQXcQ/viewform"
  },
  {
    id: "get-involved-audit",
    title: "Get Involved: Audit Your Street's Safety",
    url: "/get-involved",
    content: "Identify and report safety concerns in your neighborhood. Form link: https://docs.google.com/forms/d/e/1FAIpQLScx666YVpXuUUZUUJGqDEfClxmHn9fM48Fmdmbkd_sqD8e_IA/viewform"
  },
  {
    id: "get-involved-sss",
    title: "Get Involved: Join the National Survivor Support System",
    url: "/get-involved",
    content: "Join the Survivor Support System (SSS) network for healing, empowerment, and justice. Form link: https://docs.google.com/forms/d/1h0AZLB5OkGn8oBA0aFLJKr4r9gjK56rXCaRPUjZ6_xE/viewform?edit_requested=true"
  },
  {
    id: "impact-stats",
    title: "Impact: Movement by the Numbers",
    url: "/impact",
    content: "Impact highlights: 1,375 community members, 139 volunteers, 26 programs held, 4,000 lives touched, 4,500 pledges taken, and 2,240 Karnataka State Police (KSP) app downloads."
  },
  {
    id: "impact-ksp-app",
    title: "Impact: Karnataka State Police App",
    url: "/impact",
    content: "The KSP Mobile App is the official Karnataka State Police app. Android: https://play.google.com/store/apps/details?id=com.capulustech.ksppqrs. iOS: https://apps.apple.com/in/app/karnataka-state-police/id1358964762"
  },
  {
    id: "resources-overview",
    title: "Resources: Knowledge & Support",
    url: "/resources",
    content: "Resources provide safety information, skills, and access to support networks, including survivor support, apps, devices, safety tips, and self-defense demos."
  },
  {
    id: "resources-survivor-support",
    title: "Resources: Survivor Support Network",
    url: "/resources",
    content: "Key resources include the National Commission for Women (https://www.ncw.gov.in/), Women's Helpline 181 (tel:181), and a Local NGO Directory entry."
  },
  {
    id: "resources-safety-apps",
    title: "Resources: Safety Apps",
    url: "/resources",
    content: "Recommended apps include Himmat Plus (Delhi Police app), My Safetipin (area safety scores), and SHOUT (emergency responder network)."
  },
  {
    id: "resources-safety-devices",
    title: "Resources: Safety Devices",
    url: "/resources",
    content: "Modern safety devices include smart jewelry with SOS buttons, personal alarms, and GPS trackers."
  },
  {
    id: "resources-safety-tips-teens",
    title: "Resources: Safety Tips for Teens",
    url: "/resources",
    content: "Tips for teens: Trust your instincts; share live location with trusted contacts when traveling alone."
  },
  {
    id: "resources-safety-tips-adults",
    title: "Resources: Safety Tips for Adults",
    url: "/resources",
    content: "Tips for adults: Be aware of surroundings and avoid distractions; have keys ready and check your car before entering."
  },
  {
    id: "resources-safety-tips-seniors",
    title: "Resources: Safety Tips for Seniors",
    url: "/resources",
    content: "Tips for seniors: Avoid scams and verify requests for information; keep doors and windows locked and verify visitors."
  },
  {
    id: "resources-self-defense-demos",
    title: "Resources: Self-Defense Demos",
    url: "/resources",
    content: "Self-defense demos include Basic Escape Techniques, Situational Awareness, and Defensive Stance. The section is marked as 'will be available soon.'"
  },
  {
    id: "events-media-overview",
    title: "Events & Media Overview",
    url: "/events-media",
    content: "Events & Media highlights safety awareness programs, Safe & Well-Lit Communities work, collaboration events, and photo galleries of programs across institutions and communities."
  },
  {
    id: "events-media-upcoming",
    title: "Events & Media: Upcoming Event",
    url: "/events-media",
    content: "Upcoming event placeholder: Awareness Program. Time 11:00am-12.30pm, venue 'Location', with details to be announced."
  },
  {
    id: "events-media-collaborations",
    title: "Events & Media: Collaborations",
    url: "/events-media",
    content: "Collaborations include Police Departments, State Women Commission, and strategic meetings with institutional partners, civil society, and community leaders."
  },
  {
    id: "events-media-timeline",
    title: "Events & Media: Awareness Program Timeline",
    url: "/events-media",
    content: "Awareness program timeline includes events at Cambridge Institute of Technology (3 Oct 2024), SHVNM Government Girls PU College (19 Oct 2024), St. Joseph's Institute of Management (27 Oct 2024), multiple Sparsh Hospitals (Nov 2024-Feb 2025), Gopalan College (Dec 2024, Sep 2025), National Public School (5 Dec 2024), Ibblur Government School (30 Jan 2025), Vayah Vikas (31 Jan 2025), St. Joseph's University (1 Feb 2025), Arya Vidhya Shala (8 Feb 2025), Rotaract Lakshmibai College (20 Feb 2025), Christ College (1 Mar 2025), TVS Hosur (11 Mar 2025), Keerti Riveria Apartments (15 Mar 2025), a 'Be the Light' panel discussion (23 Mar 2025), Mphasis online (28 Mar 2025), Ashvasan senior citizens (18 Apr 2025), St. Francis PU College (1 Jul 2025), Tata Electronics (24 Jul 2025), and Fortis Hospital programs (6-7 Oct 2025)."
  },
  {
    id: "events-media-panelists",
    title: "Events & Media: Be the Light Panel",
    url: "/events-media",
    content: "Panel discussion with Arun Pai (Bangalore Walks), Baishaki (Axis Bank), Vikram Rai (Bangalore Apartment Federation), Priyanka Upendra (cine actor), Snehal (BBMP East), Pushpa S (BESCOM), and Poornima Shetty (Founder, Safety for Women Foundation). Moderator: Nithya Mandhyam (Times of India)."
  },
  {
    id: "blog-overview",
    title: "Blog Overview",
    url: "/blog",
    content: "The blog shares stories, insights, and updates on women's safety and empowerment. Contributors can write to teamsafetyforwomen@gmail.com."
  },
  {
    id: "blog-post-safe-streets",
    title: "Blog: Safe Streets, Safe Workplaces, Safe India",
    url: "/blog/safe-streets-safe-workplaces-safe-india-protecting-women-in-a-changing-world",
    content: "Article by Abdul Shakeeb (5 min read) on women's safety in India, with statistics, workplace safety, public space safety, and action steps such as education, legal reform, support systems, and community vigilance."
  },
  {
    id: "blog-post-finding-my-voice",
    title: "Blog: Finding My Voice",
    url: "/blog/finding-my-voice",
    content: "Article by Dr. Varsha Pillai (4 min read) describing a survivor's experience, the importance of speaking up, and the need for education, family conversations, reporting, mentorship, and advocacy."
  },
  {
    id: "faq-overview",
    title: "FAQ Summary",
    url: "/faq",
    content: "FAQ covers who the movement is, why it is pan-India, initiative focus, volunteer-driven model, no subscription fees, and how to contact the team at safetyforwomen@gmail.com. It notes collaboration with Bengaluru Police and Parihar."
  },
  {
    id: "faq-key-points",
    title: "FAQ Key Points",
    url: "/faq",
    content: "Key answers: founded September 1, 2024; open to everyone; men and boys are encouraged to join; services are volunteer-driven with no payment; the movement is pan-India; victims are referred to NGOs and relevant authorities."
  },
  {
    id: "privacy-policy",
    title: "Privacy Policy",
    url: "/privacy-policy",
    content: "Privacy policy for Safety for Women (powered by Iron Feather Foundation) aligns with India's Digital Personal Data Protection Act 2023. It explains data collected (name, phone, email, location, participation), handling of sensitive SSS data, purposes, consent, sharing only with verified partners, data retention, security practices, and grievance contact at reach@safetyforwomen.org."
  },
  {
    id: "terms-conditions",
    title: "Terms & Conditions",
    url: "/terms-conditions",
    content: "Terms include intellectual property rights, restrictions on reuse, a license for user content, no warranties, limitation of liability, and a contact email for questions at safetyforwomen@gmail.com."
  },
  {
    id: "un-sdgs",
    title: "UN SDG Alignment",
    url: "/",
    content: "Safety for Women aligns with UN SDGs including Goal 3, 4, 5, 11, 16, and 17. Each goal is linked to the official UN SDG page."
  },
  {
    id: "newsletter",
    title: "Newsletter and Contact Cards",
    url: "/",
    content: "Newsletter invites users to subscribe for updates and provides contact email teamsafetyforwomen@gmail.com and social follow options."
  },
  {
    id: "header-nav",
    title: "Navigation Links",
    url: "/",
    content: "Primary navigation includes Home, About Us, Our Initiatives, Our Impact, Resources, Events & Media, Join Us, Blog, and FAQ. A call button is provided to dial 112 on mobile."
  },
  {
    id: "footer-contact",
    title: "Footer Contacts and Socials",
    url: "/",
    content: "Footer provides social links: Facebook, X (Twitter), LinkedIn, YouTube, Instagram, Telegram, WhatsApp, and email teamsafetyforwomen@gmail.com. It includes Privacy Policy and Terms & Conditions links."
  }
];

// src/index.ts
var STOP_WORDS = /* @__PURE__ */ new Set([
  "a",
  "an",
  "and",
  "are",
  "as",
  "at",
  "be",
  "but",
  "by",
  "for",
  "from",
  "has",
  "have",
  "in",
  "is",
  "it",
  "its",
  "of",
  "on",
  "or",
  "that",
  "the",
  "their",
  "there",
  "this",
  "to",
  "was",
  "were",
  "with",
  "you",
  "your"
]);
var tokenize = /* @__PURE__ */ __name((text) => text.toLowerCase().replace(/[^a-z0-9\s]/g, " ").split(/\s+/).filter(Boolean).filter((token) => !STOP_WORDS.has(token)), "tokenize");
var buildDocVectors = /* @__PURE__ */ __name((docs) => {
  const tokenized = docs.map((doc) => tokenize(`${doc.title} ${doc.content}`));
  const docCount = docs.length;
  const df = /* @__PURE__ */ new Map();
  tokenized.forEach((tokens) => {
    const unique = new Set(tokens);
    unique.forEach((token) => {
      df.set(token, (df.get(token) ?? 0) + 1);
    });
  });
  const idf = /* @__PURE__ */ __name((token) => Math.log((docCount + 1) / ((df.get(token) ?? 0) + 1)) + 1, "idf");
  return docs.map((doc, index) => {
    const tf = /* @__PURE__ */ new Map();
    tokenized[index].forEach((token) => {
      tf.set(token, (tf.get(token) ?? 0) + 1);
    });
    const weights = /* @__PURE__ */ new Map();
    let norm = 0;
    tf.forEach((count, token) => {
      const weight = (1 + Math.log(count)) * idf(token);
      weights.set(token, weight);
      norm += weight * weight;
    });
    return {
      doc,
      weights,
      norm: Math.sqrt(norm)
    };
  });
}, "buildDocVectors");
var DOC_VECTORS = buildDocVectors(KNOWLEDGE_BASE);
var rankDocuments = /* @__PURE__ */ __name((query) => {
  const queryTokens = tokenize(query);
  if (queryTokens.length === 0) {
    return [];
  }
  const tf = /* @__PURE__ */ new Map();
  queryTokens.forEach((token) => {
    tf.set(token, (tf.get(token) ?? 0) + 1);
  });
  const queryWeights = /* @__PURE__ */ new Map();
  let queryNorm = 0;
  tf.forEach((count, token) => {
    const weight = 1 + Math.log(count);
    queryWeights.set(token, weight);
    queryNorm += weight * weight;
  });
  queryNorm = Math.sqrt(queryNorm);
  if (queryNorm === 0) {
    return [];
  }
  return DOC_VECTORS.map((vector) => {
    let dot = 0;
    queryWeights.forEach((weight, token) => {
      const docWeight = vector.weights.get(token);
      if (docWeight) {
        dot += weight * docWeight;
      }
    });
    const score = vector.norm > 0 ? dot / (vector.norm * queryNorm) : 0;
    return { doc: vector.doc, score };
  }).filter((match) => match.score > 0).sort((a, b) => b.score - a.score);
}, "rankDocuments");
var buildSnippet = /* @__PURE__ */ __name((content) => {
  const sentences = content.split(". ");
  if (sentences.length <= 2) {
    return content;
  }
  return `${sentences.slice(0, 2).join(". ")}.`;
}, "buildSnippet");
var buildChatResponse = /* @__PURE__ */ __name((matches, query) => {
  if (matches.length === 0 || matches[0].score < 0.08) {
    return {
      answer: "I can only answer questions based on Safety for Women website content, and I could not find a good match for that yet. Try asking about the movement, initiatives, how to get involved, or contact details.",
      sources: []
    };
  }
  const topMatches = matches.slice(0, 3);
  const snippets = topMatches.map((match) => `- ${match.doc.title}: ${buildSnippet(match.doc.content)}`).join("\n");
  return {
    answer: `Here is what I found on the site about "${query}":
${snippets}`,
    sources: topMatches.map((match) => ({ title: match.doc.title, url: match.doc.url }))
  };
}, "buildChatResponse");
var src_default = {
  async fetch(request, env, ctx) {
    const corsHeaders = {
      "Access-Control-Allow-Origin": "*",
      "Access-Control-Allow-Methods": "POST, OPTIONS",
      "Access-Control-Allow-Headers": "Content-Type"
    };
    if (request.method === "OPTIONS") {
      return new Response(null, {
        headers: corsHeaders
      });
    }
    if (request.method !== "POST") {
      return new Response("Method Not Allowed", { status: 405, headers: corsHeaders });
    }
    const url = new URL(request.url);
    if (url.pathname === "/api/pledge") {
      try {
        const data = await request.json();
        const { name, mobileNumber, pinCode, state } = data;
        if (!name || !mobileNumber || !pinCode || !state) {
          return new Response(JSON.stringify({ error: "Missing required fields" }), {
            status: 400,
            headers: { ...corsHeaders, "Content-Type": "application/json" }
          });
        }
        const query = `
          INSERT INTO pledge ("Name", "Mobile Number", "Pin code", "State")
          VALUES (?, ?, ?, ?)
        `;
        const { success } = await env.DB.prepare(query).bind(name, mobileNumber, pinCode, state).run();
        if (success) {
          return new Response(JSON.stringify({ message: "Pledge submitted successfully" }), {
            status: 201,
            headers: { ...corsHeaders, "Content-Type": "application/json" }
          });
        } else {
          throw new Error("Failed to insert into database");
        }
      } catch (err) {
        console.error(err);
        return new Response(JSON.stringify({ error: "Internal Server Error" }), {
          status: 500,
          headers: { ...corsHeaders, "Content-Type": "application/json" }
        });
      }
    }
    if (url.pathname === "/api/chat") {
      try {
        const data = await request.json();
        const message = data?.message?.toString().trim();
        if (!message) {
          return new Response(JSON.stringify({ error: "Message is required" }), {
            status: 400,
            headers: { ...corsHeaders, "Content-Type": "application/json" }
          });
        }
        const matches = rankDocuments(message);
        const response = buildChatResponse(matches, message);
        return new Response(JSON.stringify(response), {
          status: 200,
          headers: { ...corsHeaders, "Content-Type": "application/json" }
        });
      } catch (err) {
        console.error(err);
        return new Response(JSON.stringify({ error: "Internal Server Error" }), {
          status: 500,
          headers: { ...corsHeaders, "Content-Type": "application/json" }
        });
      }
    }
    return new Response("Not Found", { status: 404, headers: corsHeaders });
  }
};

// ../node_modules/wrangler/templates/middleware/middleware-ensure-req-body-drained.ts
var drainBody = /* @__PURE__ */ __name(async (request, env, _ctx, middlewareCtx) => {
  try {
    return await middlewareCtx.next(request, env);
  } finally {
    try {
      if (request.body !== null && !request.bodyUsed) {
        const reader = request.body.getReader();
        while (!(await reader.read()).done) {
        }
      }
    } catch (e) {
      console.error("Failed to drain the unused request body.", e);
    }
  }
}, "drainBody");
var middleware_ensure_req_body_drained_default = drainBody;

// ../node_modules/wrangler/templates/middleware/middleware-miniflare3-json-error.ts
function reduceError(e) {
  return {
    name: e?.name,
    message: e?.message ?? String(e),
    stack: e?.stack,
    cause: e?.cause === void 0 ? void 0 : reduceError(e.cause)
  };
}
__name(reduceError, "reduceError");
var jsonError = /* @__PURE__ */ __name(async (request, env, _ctx, middlewareCtx) => {
  try {
    return await middlewareCtx.next(request, env);
  } catch (e) {
    const error = reduceError(e);
    return Response.json(error, {
      status: 500,
      headers: { "MF-Experimental-Error-Stack": "true" }
    });
  }
}, "jsonError");
var middleware_miniflare3_json_error_default = jsonError;

// .wrangler/tmp/bundle-TJc3sm/middleware-insertion-facade.js
var __INTERNAL_WRANGLER_MIDDLEWARE__ = [
  middleware_ensure_req_body_drained_default,
  middleware_miniflare3_json_error_default
];
var middleware_insertion_facade_default = src_default;

// ../node_modules/wrangler/templates/middleware/common.ts
var __facade_middleware__ = [];
function __facade_register__(...args) {
  __facade_middleware__.push(...args.flat());
}
__name(__facade_register__, "__facade_register__");
function __facade_invokeChain__(request, env, ctx, dispatch, middlewareChain) {
  const [head, ...tail] = middlewareChain;
  const middlewareCtx = {
    dispatch,
    next(newRequest, newEnv) {
      return __facade_invokeChain__(newRequest, newEnv, ctx, dispatch, tail);
    }
  };
  return head(request, env, ctx, middlewareCtx);
}
__name(__facade_invokeChain__, "__facade_invokeChain__");
function __facade_invoke__(request, env, ctx, dispatch, finalMiddleware) {
  return __facade_invokeChain__(request, env, ctx, dispatch, [
    ...__facade_middleware__,
    finalMiddleware
  ]);
}
__name(__facade_invoke__, "__facade_invoke__");

// .wrangler/tmp/bundle-TJc3sm/middleware-loader.entry.ts
var __Facade_ScheduledController__ = class ___Facade_ScheduledController__ {
  constructor(scheduledTime, cron, noRetry) {
    this.scheduledTime = scheduledTime;
    this.cron = cron;
    this.#noRetry = noRetry;
  }
  static {
    __name(this, "__Facade_ScheduledController__");
  }
  #noRetry;
  noRetry() {
    if (!(this instanceof ___Facade_ScheduledController__)) {
      throw new TypeError("Illegal invocation");
    }
    this.#noRetry();
  }
};
function wrapExportedHandler(worker) {
  if (__INTERNAL_WRANGLER_MIDDLEWARE__ === void 0 || __INTERNAL_WRANGLER_MIDDLEWARE__.length === 0) {
    return worker;
  }
  for (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {
    __facade_register__(middleware);
  }
  const fetchDispatcher = /* @__PURE__ */ __name(function(request, env, ctx) {
    if (worker.fetch === void 0) {
      throw new Error("Handler does not export a fetch() function.");
    }
    return worker.fetch(request, env, ctx);
  }, "fetchDispatcher");
  return {
    ...worker,
    fetch(request, env, ctx) {
      const dispatcher = /* @__PURE__ */ __name(function(type, init) {
        if (type === "scheduled" && worker.scheduled !== void 0) {
          const controller = new __Facade_ScheduledController__(
            Date.now(),
            init.cron ?? "",
            () => {
            }
          );
          return worker.scheduled(controller, env, ctx);
        }
      }, "dispatcher");
      return __facade_invoke__(request, env, ctx, dispatcher, fetchDispatcher);
    }
  };
}
__name(wrapExportedHandler, "wrapExportedHandler");
function wrapWorkerEntrypoint(klass) {
  if (__INTERNAL_WRANGLER_MIDDLEWARE__ === void 0 || __INTERNAL_WRANGLER_MIDDLEWARE__.length === 0) {
    return klass;
  }
  for (const middleware of __INTERNAL_WRANGLER_MIDDLEWARE__) {
    __facade_register__(middleware);
  }
  return class extends klass {
    #fetchDispatcher = /* @__PURE__ */ __name((request, env, ctx) => {
      this.env = env;
      this.ctx = ctx;
      if (super.fetch === void 0) {
        throw new Error("Entrypoint class does not define a fetch() function.");
      }
      return super.fetch(request);
    }, "#fetchDispatcher");
    #dispatcher = /* @__PURE__ */ __name((type, init) => {
      if (type === "scheduled" && super.scheduled !== void 0) {
        const controller = new __Facade_ScheduledController__(
          Date.now(),
          init.cron ?? "",
          () => {
          }
        );
        return super.scheduled(controller);
      }
    }, "#dispatcher");
    fetch(request) {
      return __facade_invoke__(
        request,
        this.env,
        this.ctx,
        this.#dispatcher,
        this.#fetchDispatcher
      );
    }
  };
}
__name(wrapWorkerEntrypoint, "wrapWorkerEntrypoint");
var WRAPPED_ENTRY;
if (typeof middleware_insertion_facade_default === "object") {
  WRAPPED_ENTRY = wrapExportedHandler(middleware_insertion_facade_default);
} else if (typeof middleware_insertion_facade_default === "function") {
  WRAPPED_ENTRY = wrapWorkerEntrypoint(middleware_insertion_facade_default);
}
var middleware_loader_entry_default = WRAPPED_ENTRY;
export {
  __INTERNAL_WRANGLER_MIDDLEWARE__,
  middleware_loader_entry_default as default
};
//# sourceMappingURL=index.js.map
